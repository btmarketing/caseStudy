////////////////////////////////////////////////
////////////////////////////////////////////////
////////////////////////////////////////////////
function Checker(e,t){this.full=t;this.index=e;this.corners;this.el;this.canvas;this.context;this.targetIndex=this.index;this.prevExchange=undefined;this.stepCount=0;this.stepAmount=2.5;this.seemStep=gutter/2;this.shrunk=!0;this.grown=!1;this.mouse={x:undefined,y:undefined};this.adder={l:0,r:0,t:0,b:0,total:0};this.touched=!1;this.neighborSpace;if(this.full){var n=this;this.el=document.createElement("div");this.el.style.overflow="hidden";this.el.style.position="absolute";this.el.style.cursor="move";this.el.style.backgroundColor="rgb(150,150,150)";this.el.onmousedown=function(e){if(n.shrunk&&!n.grown){n.el.style.opacity=.75;endRandomSorting();var t=e.x,r=e.y;if(!t){t=e.clientX;r=e.clientY}n.initMouseDrag(t,r)}};this.canvas=document.createElement("canvas");this.canvas.width=unitSize;this.canvas.height=unitSize;this.canvas.style.width=unitSize+"px";this.canvas.style.height=unitSize+"px";this.canvas.style.position="absolute";this.canvas.style.left=-gutter+"px";this.canvas.style.top=-gutter+"px";this.context=this.canvas.getContext("2d");this.el.appendChild(this.canvas);document.getElementById("checkerBoard").appendChild(this.el)}this.updateCorners();this.prevCorners}function shrinkCheckers(e){shrinking=!0;var t=!1;for(var n=0;n<checkers.length;n++)if(!checkers[n].shrunk){checkers[n].shrink();t=!0}if(!t){shrinking=!1;makeTargetCheckerLayout();e||selectCurrentChecker()}}function growCheckers(){growing=!0;var e=!1;for(var t=0;t<checkers.length;t++)if(!checkers[t].grown){checkers[t].grow();e=!0}if(!e){growing=!1;currentEmptyChecker=-1;movingChecker=-1}}function selectCurrentChecker(){movingChecker=-1;var e=Math.floor(Math.random()*checkers.length),t=!1;for(var n=0;n<checkers.length;n++){var r=(n+e)%checkers.length;if(!checkers[r].full&&checkers[r].targetIndex!==checkers[r].index){currentEmptyChecker=r;t=!0;break}}if(!t)if(buckets[currentNavigation]){growCheckers();buckets[currentNavigation].fading=!0;buckets[currentNavigation].show()}else triggerRandomSorting()}function updateAllCheckerPositions(){for(var e=0;e<checkers.length;e++)checkers[e].updateCorners()}function endRandomSorting(){currentEmptyChecker=-1;buckets[currentNavigation]&&buckets[currentNavigation].deselect();currentNavigation=-1;movingChecker=-1;clicked=!0;updateAllCheckerPositions()}function triggerRandomSorting(){currentCoords=(currentCoords+1)%coordinates.length;makeTargetCheckerLayout();selectCurrentChecker()}function updateCheckers(){!buckets[currentNavigation]&&!checkers[currentEmptyChecker]&&!checkers[movingChecker]&&!clicked;checkers[movingChecker]?checkers[movingChecker].slideCorners():checkers[currentEmptyChecker]?checkers[currentEmptyChecker].slideThisChecker():shrinking?shrinkCheckers():growing&&growCheckers()}function makeCheckerBoard(){var e=0;for(var t in dimensions){var n=dimensions[t].width,r=dimensions[t].height;for(var i=0;i<n;i++)for(var s=0;s<r;s++)e++}var o=[];for(var u=0;u<xDim*yDim;u++)o[u]=u;for(var u=0;u<xDim*yDim;u++){var a=Math.floor(Math.random()*o.length),f=o[a];o.splice(a,1);var l=!0;u>=e&&(l=!1);checkers[u]=new Checker(f,l)}document.body.onmousemove=function(e){for(var t=0;t<checkers.length;t++)if(checkers[t].touched){checkers[t].updateCorners(!0);var n=e.x,r=e.y;if(!n){n=e.clientX;r=e.clientY}var i=n-(checkers[t].corners.l+checkers[t].mouse.x),s=r-(checkers[t].corners.t+checkers[t].mouse.y);checkers[t].mouseSlide(i,s,n,r);break}};document.body.onmouseup=function(e){for(var t=0;t<checkers.length;t++)if(checkers[t].touched){checkers[t].touched=!1;checkers[t].mouse={x:undefined,y:undefined};checkers[t].updateCorners();checkers[t].el.style.opacity=1}checkCheckerPositions()}}function checkCheckerPositions(){var e=0,t=undefined;for(var n=0;n<checkers.length;n++)if(checkers[n].full){t===undefined&&(t=checkers[n].index);checkers[n].index!==n+t&&e++}e===0&&console.log("YOU WON!!!!!")}function assignEmptyCheckers(){var e={};for(var t=0;t<checkers.length;t++)if(!checkers[t].full){var n=undefined,r=checkers[t].index%xDim,i=Math.floor(checkers[t].index/xDim),s=999999;for(var o=0;o<targetLayout.length;o++)if(targetLayout[o]==="empty"){var u=o%xDim,a=Math.floor(o/xDim),f=Math.abs(u-r)+Math.abs(a-i);if(f<s&&!e[o]){s=f;n=o}}if(n!==undefined){checkers[t].targetIndex=n;e[n]=!0}else console.log("we messed up on finding a space for checker "+t)}}function makeTargetCheckerLayout(){clearTargetLayout();var e=coordinates[currentCoords];for(var t in e){var n=dimensions[t].width,r=dimensions[t].height,i=e[t].l,s=e[t].t;for(var o=i;o<i+n;o++){var u=!0,a=!0;o===i&&(u=undefined);o===i+n-1&&(a=undefined);n===1&&(a=undefined);for(var f=s;f<s+r;f++){var l=!0,c=!0;f===s&&(l=undefined);f===s+r-1&&(c=undefined);r===1&&(c=undefined);var h=o+f*xDim;targetLayout[h]={index:h,l:u,r:a,t:l,b:c}}}}assignEmptyCheckers()}function clearTargetLayout(){targetLayout=[];for(var e=0;e<xDim*yDim;e++)targetLayout[e]="empty"}Checker.prototype.initMouseDrag=function(e,t){this.touched=!0;this.mouse.x=e-this.corners.l;this.mouse.y=t-this.corners.t;this.findNeighboringSpaces()};Checker.prototype.slideCorners=function(){var e=this.stepAmount-this.stepCount,t=this.index%xDim,n=Math.floor(this.index/xDim),r={l:t*unitSize+gutter+center.l,r:t*unitSize+unitSize-gutter+center.l,t:n*unitSize+gutter+center.t,b:n*unitSize+unitSize-gutter+center.t};this.corners.l+=(r.l-this.corners.l)/e;this.corners.r+=(r.r-this.corners.r)/e;this.corners.t+=(r.t-this.corners.t)/e;this.corners.b+=(r.b-this.corners.b)/e;this.updateDOM();this.prevCorners=this.corners;this.stepCount++;if(this.stepCount>=this.stepAmount){this.stepCount=0;this.updateCorners();selectCurrentChecker()}};Checker.prototype.updateCorners=function(e){var t=this.index%xDim,n=Math.floor(this.index/xDim);this.corners={l:t*unitSize+gutter+center.l+this.adder.l,r:t*unitSize+unitSize-gutter+center.l+this.adder.r,t:n*unitSize+gutter+center.t+this.adder.t,b:n*unitSize+unitSize-gutter+center.t+this.adder.b};this.el&&this.prevCorners!==this.corners&&!e&&this.updateDOM();this.prevCorners=this.corners};Checker.prototype.updateDOM=function(){var e=this.corners.l,t=this.corners.t,n=this.corners.r-e,r=this.corners.b-t;n!==this.el.offsetWidth&&(this.el.style.width=Math.round(n)+"px");r!==this.el.offsetHeight&&(this.el.style.height=Math.round(r)+"px");e!==this.el.offsetLeft&&(this.el.style.left=Math.round(e)+"px");t!==this.el.offsetTop&&(this.el.style.top=Math.round(t)+"px")};Checker.prototype.slideThisChecker=function(){var e=this.targetIndex%xDim-this.index%xDim,t=Math.floor(this.targetIndex/xDim)-Math.floor(this.index/xDim);if(e||t){var n=t/Math.abs(t),r=this.index+n*xDim;if(Math.abs(e)>Math.abs(t))var n=e/Math.abs(e),r=this.index+n;for(var i=0;i<checkers.length;i++)if(checkers[i].index===r){checkers[i].index=this.index;this.index=r;checkers[i].full?movingChecker=i:this.slideThisChecker();break}}else selectCurrentChecker()};Checker.prototype.grow=function(){this.grown=!1;this.shrunk=!1;var e=targetLayout[this.index];if(e!=="empty"){if(e.l){this.adder.l-=this.seemStep;this.canvas.style.left=Math.round(gutter+this.adder.l)*-1+"px"}e.r&&(this.adder.r+=this.seemStep);if(e.t){this.adder.t-=this.seemStep;this.canvas.style.top=Math.round(gutter+this.adder.t)*-1+"px"}e.b&&(this.adder.b+=this.seemStep)}this.adder.total+=this.seemStep;if(this.adder.total>=gutter){this.adder.total=gutter;e.l&&(this.adder.l=-gutter);e.r&&(this.adder.r=gutter);e.t&&(this.adder.t=-gutter);e.b&&(this.adder.b=gutter);this.grown=!0}this.updateCorners()};Checker.prototype.shrink=function(){this.shrunk=!1;this.grown=!1;var e=targetLayout[this.index];if(e!=="empty"){if(e.l){this.adder.l+=this.seemStep;this.canvas.style.left=Math.round(gutter+this.adder.l)*-1+"px"}e.r&&(this.adder.r-=this.seemStep);if(e.t){this.adder.t+=this.seemStep;this.canvas.style.top=Math.round(gutter+this.adder.t)*-1+"px"}e.b&&(this.adder.b-=this.seemStep)}this.adder.total-=this.seemStep;if(this.adder.total<=0){this.adder.total=0;this.adder.r=0;this.adder.l=0;this.adder.t=0;this.adder.b=0;this.shrunk=!0}this.updateCorners()};Checker.prototype.findNeighboringSpaces=function(){this.neighborSpace={l:!1,r:!1,t:!1,b:!1};for(var e=0;e<checkers.length;e++)checkers[e].full||(checkers[e].index===this.index-1&&checkers[e].index%xDim!==-1?this.neighborSpace.l=!0:checkers[e].index===this.index+1&&checkers[e].index%xDim!==xDim?this.neighborSpace.r=!0:checkers[e].index===this.index-xDim&&Math.floor(checkers[e].index/xDim)!==-1?this.neighborSpace.t=!0:checkers[e].index===this.index+xDim&&Math.floor(checkers[e].index/xDim)!==yDim&&(this.neighborSpace.b=!0))};Checker.prototype.mouseSlide=function(e,t,n,r){var i=!1;if(Math.abs(e)>Math.abs(t)){var s=Math.floor(this.index/xDim),o=s*unitSize+gutter+center.t+this.adder.t;if(this.corners.t===o)if(e<0&&this.neighborSpace.l){this.corners.l+=e;this.corners.r+=e;if(this.corners.l<center.l+gutter){this.corners.l=center.l+gutter;this.corners.r=unitSize-gutter*2+this.corners.l}i=!0;this.updateDOM()}else if(e>0&&this.neighborSpace.r){this.corners.l+=e;this.corners.r+=e;if(this.corners.r>xDim*unitSize+center.l-gutter){this.corners.r=xDim*unitSize+center.l-gutter;this.corners.l=this.corners.r-(unitSize-gutter*2)}i=!0;this.updateDOM()}}if(!i&&Math.abs(t)>0){var u=this.index%xDim,a=u*unitSize+gutter+center.l+this.adder.l;if(this.corners.l===a)if(t<0&&this.neighborSpace.t){this.corners.t+=t;this.corners.b+=t;if(this.corners.t<center.t+gutter){this.corners.t=center.t+gutter;this.corners.b=this.corners.t+(unitSize-gutter*2)}this.updateDOM()}else if(t>0&&this.neighborSpace.b){this.corners.t+=t;this.corners.b+=t;if(this.corners.b>yDim*unitSize+center.t-gutter){this.corners.b=yDim*unitSize+center.t-gutter;this.corners.t=this.corners.b-(unitSize-gutter*2)}this.updateDOM()}}var f=undefined;Math.abs(e)>unitSize*.5?e<0&&this.index%xDim!==0&&this.neighborSpace.l?f=this.index-1:e>0&&this.index%xDim<xDim-1&&this.neighborSpace.r&&(f=this.index+1):Math.abs(t)>unitSize*.5&&(t<0&&Math.floor(this.index/xDim)!==0&&this.neighborSpace.t?f=this.index-xDim:t>0&&Math.floor(this.index/xDim)<=yDim-1&&this.neighborSpace.b&&(f=this.index+xDim));if(f!==undefined)for(var l=0;l<checkers.length;l++)if(checkers[l].index===f){checkers[l].index=this.index;checkers[l].updateCorners();this.index=f;this.initMouseDrag(n,r)}};var shrinking=!1,growing=!1,clicked=!1,currentEmptyChecker=-1,movingChecker=-1,xDim=10,yDim=5,checkers=[],targetLayout;